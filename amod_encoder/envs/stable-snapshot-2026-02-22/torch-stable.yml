# ===========================================================================
#  torch-stable — General-purpose PyTorch environment (RTX 5070 Ti)
# ===========================================================================
#
#  Hardware: NVIDIA GeForce RTX 5070 Ti (Blackwell, sm_120, 16 GB VRAM)
#  Driver:   576.88+ / CUDA 12.9
#  PyTorch:  Stable release with CUDA 12.8 (sm_120 included)
#
#  Usage:
#    conda env create -f envs/torch-stable.yml
#    conda activate torch-stable
#
#  This is the "throw anything at it" env. Use it for WhisperX, NeMo,
#  diffusion models, fine-tuning, inference — anything that needs a
#  recent stable torch with GPU support on Blackwell.
# ===========================================================================

name: torch-stable

channels:
  - conda-forge
  - defaults

dependencies:
  - python=3.11
  - pip

  # ---------- BLAS (OpenBLAS, NOT MKL — avoids OpenMP conflict with torch) ----------
  - libblas=*=*openblas*
  - libcblas=*=*openblas*
  - liblapack=*=*openblas*

  # ---------- Core Scientific ----------
  - numpy>=1.26
  - scipy>=1.12
  - pandas>=2.1
  - matplotlib>=3.8
  - scikit-learn>=1.4

  # ---------- Media / Audio ----------
  - ffmpeg>=6.0
  # NOTE: Do NOT install pillow via conda — it causes DLL conflicts
  #       with pip-installed torchvision on Windows. Pillow is installed
  #       automatically by torchvision via pip below.

  # ---------- Utilities ----------
  - rich>=13.0
  - tqdm>=4.66
  - pyyaml>=6.0
  - requests>=2.31

  # ---------- Dev ----------
  - jupyterlab>=4.0
  - ipywidgets>=8.0
  - pytest>=8.0

  # ---------- Pip-Only (PyTorch + ecosystem) ----------
  - pip:
    - --extra-index-url https://download.pytorch.org/whl/cu128
    - torch>=2.10.0
    - torchvision>=0.25.0
    - torchaudio>=2.10.0

    # -- Common model libraries --
    - timm>=1.0
    - transformers>=4.40
    - accelerate>=0.30
    - safetensors>=0.4
    - tokenizers>=0.19
    - datasets>=2.18
    - huggingface-hub>=0.23

    # -- Image/Video --
    - opencv-python>=4.9
    - torchcodec>=0.1

    # -- Monitoring --
    - nvidia-ml-py>=12.0
    - wandb>=0.16
