# ===========================================================================
#  brain-encoders — Neuroimaging encoding-model pipeline (RTX 5070 Ti)
# ===========================================================================
#
#  Hardware: NVIDIA GeForce RTX 5070 Ti (Blackwell, sm_120, 16 GB VRAM)
#  Driver:   576.88+ / CUDA 12.9
#  PyTorch:  Stable release with CUDA 12.8 (sm_120 included)
#
#  Usage:
#    conda env create -f envs/brain-encoders.yml
#    conda activate brain-encoders
#    pip install -e ".[all]"
#
#  Purpose: Everything needed for the amod_encoder pipeline — neuroimaging
#  I/O, PLS/Ridge models, feature extraction, statistical analysis.
# ===========================================================================

name: brain-encoders

channels:
  - conda-forge
  - defaults

dependencies:
  - python=3.11
  - pip

  # ---------- BLAS (OpenBLAS, NOT MKL — avoids OpenMP conflict with torch) ----------
  - libblas=*=*openblas*
  - libcblas=*=*openblas*
  - liblapack=*=*openblas*

  # ---------- Core Scientific Stack ----------
  - numpy>=1.26
  - scipy>=1.12
  - pandas>=2.1
  - matplotlib>=3.8
  - scikit-learn>=1.4

  # ---------- Neuroimaging ----------
  - nibabel>=5.2
  - nilearn>=0.10

  # ---------- Stats (MATLAB-matching) ----------
  - statsmodels>=0.14

  # ---------- Rich Terminal Dashboard ----------
  - rich>=13.0

  # ---------- Media ----------
  - ffmpeg>=6.0
  # NOTE: Do NOT install pillow via conda — it causes DLL conflicts
  #       with pip-installed torchvision on Windows. Pillow is installed
  #       automatically by torchvision via pip below.

  # ---------- Pip-Only Packages ----------
  - pip:
    # -- PyTorch (Blackwell / CUDA 12.8, stable) --
    - --extra-index-url https://download.pytorch.org/whl/cu128
    - torch>=2.10.0
    - torchvision>=0.25.0
    - torchaudio>=2.10.0

    # -- Feature extraction (model-agnostic) --
    - timm>=1.0
    - transformers>=4.40
    - opencv-python>=4.9

    # -- Encoding pipeline core --
    - pyyaml>=6.0
    - typer[all]>=0.9
    - h5py>=3.10
    - pydantic>=2.5

    # -- Stats extras --
    - pingouin>=0.5

    # -- Monitoring --
    - nvidia-ml-py>=12.0

    # -- ML Ecosystem --
    - accelerate>=0.30
    - datasets>=2.18
    - wandb>=0.16

    # -- Dev / QA --
    - pytest>=8.0
    - pytest-cov>=4.0
    - ruff>=0.4
    - mypy>=1.8
